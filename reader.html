<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Reader</title>
<style>
body { margin:0; background:black; }
img { display:block; width:100vw; }
p { color:white; text-align:center; padding:50px; }
</style>
</head>
<body>

<div id="comic-container"></div>

<script>
(async function() {
  const params = new URLSearchParams(window.location.search);
  const comicKey = params.get("comic");
  const chapter = Number(params.get("chapter"));

  const container = document.getElementById("comic-container");

  if (!comicKey || !chapter) {
    container.innerHTML = "<p>Brak komiksu lub rozdziału w URL.</p>";
    return;
  }

  /* ===== OSTATNIO CZYTANE – ZAPIS ===== */
  const recentKey = "recentComics";
  let recent = JSON.parse(localStorage.getItem(recentKey)) || [];

  recent = recent.filter(c => c !== comicKey);
  recent.unshift(comicKey);
  recent = recent.slice(0, 10);
  localStorage.setItem(recentKey, JSON.stringify(recent));

  /* ===== POBIERZ JSON KOMIKSU ===== */
  try {
    const res = await fetch(`comics/${comicKey}.json`);

    if (!res.ok) {
      throw new Error("Nie udało się pobrać danych komiksu.");
    }

    const data = await res.json();

    if (!data.chapters || !data.chapters[chapter]) {
      container.innerHTML = "<p>Brak obrazków dla tego rozdziału.</p>";
      return;
    }

    data.chapters[chapter].forEach(src => {
      const img = document.createElement("img");
      img.src = src;
      container.appendChild(img);
    });

  } catch (e) {
    container.innerHTML = `<p>Błąd: ${e.message}</p>`;
  }
})();
</script>

</body>
</html>
